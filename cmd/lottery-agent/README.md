# 🎉 Linux.do 抽奖助手

一个独立的自动化agent，用于监控 Linux.do 论坛的抽奖帖并自动参与。

## 功能特性

- ✅ 自动检测包含"抽奖"关键词的帖子
- ✅ 随机回复参与话术，显得更自然
- ✅ 记录已回复的帖子，避免重复回复
- ✅ 定时轮询，持续监控新帖
- ✅ 状态持久化，重启后不会重复回复
- ✅ 自动清理30天前的旧记录

## 监控关键词

程序会检测帖子标题中是否包含以下关键词：

- 抽奖
- 送书
- 送码
- 赠送
- 福利
- 抽取
- 免费送

## 回复话术

随机从以下话术中选择一个回复：

- 参与一下
- 谢谢大佬
- 参与参与
- 感谢分享
- 来了来了
- 支持支持
- 感谢
- 参与
- 来参与一下
- 谢谢楼主

## 编译

```bash
go build -o lottery-agent cmd/lottery-agent/main.go
```

## 使用方法

### 设置环境变量

```bash
export LINUXDO_USERNAME="your_username"
export LINUXDO_PASSWORD="your_password"
export HTTPS_PROXY="http://127.0.0.1:7890"  # 可选
export NO_PROXY="localhost,127.0.0.1"       # 可选
```

说明：程序会自动读取 `HTTPS_PROXY` / `HTTP_PROXY`（含小写形式），`HTTPS_PROXY` 优先。代理 URL 非法时会直接启动失败，不会降级直连。

### 运行

```bash
./lottery-agent
```

程序将持续运行，每5分钟检查一次新帖。

### 后台运行

使用 `nohup` 或 `screen` 在后台运行：

```bash
# 使用 nohup
nohup ./lottery-agent > lottery-agent.log 2>&1 &

# 使用 screen
screen -S lottery
./lottery-agent
# 按 Ctrl+A 然后 D 来分离会话
```

## 配置说明

可以在代码中修改以下常量：

```go
const (
    checkInterval  = 5 * time.Minute  // 检查间隔
    maxTopicsCheck = 50               // 每次检查的话题数量
)
```

## 状态文件

程序会在用户目录下创建 `~/.lottery_agent_state.json` 文件，记录：

- 已回复的话题ID和时间
- 上次检查时间

**注意：** 删除此文件会导致程序重新回复所有抽奖帖。

## 工作流程

1. **启动时**：加载已回复记录，清理30天前的旧记录
2. **检查循环**：
   - 获取最新50个话题
   - 检查标题是否包含抽奖关键词
   - 验证是否已经回复过
   - 随机选择话术并回复
   - 保存回复记录
3. **等待**：休眠5分钟后重复检查

## 安全特性

- ✅ 随机等待1-5秒后回复，模拟人工操作
- ✅ 每次回复后等待5-15秒，避免被识别为机器人
- ✅ 双重检查已回复状态（本地记录 + 服务器验证）
- ✅ 自动清理旧记录，避免状态文件过大

## 日志示例

```
🤖 Linux.do 抽奖助手启动中...
✅ 登录成功! 用户: your_username
📂 加载状态: 已记录 15 个已回复话题
🔍 开始监控抽奖帖...
⏰ 检查间隔: 5m0s
💬 回复话术: [参与一下 谢谢大佬 参与参与 感谢分享 ...]

按 Ctrl+C 退出

[2026-02-08 15:30:00] 开始检查新帖...
🎉 发现抽奖帖: [12345] 【抽奖】送3本技术书籍
   ✅ 已回复: "谢谢大佬"
📊 检查完成: 检查了 50 个话题, 发现 1 个抽奖帖, 新回复 1 个

[2026-02-08 15:35:00] 开始检查新帖...
📊 检查完成: 检查了 50 个话题, 发现 0 个抽奖帖, 新回复 0 个
```

## 停止程序

按 `Ctrl+C` 停止程序。如果是后台运行：

```bash
# 查找进程
ps aux | grep lottery-agent

# 停止进程
kill <PID>
```

## 注意事项

1. **频率限制**：默认5分钟检查一次，避免频繁请求
2. **账号安全**：不要泄露环境变量中的账号信息
3. **使用规范**：仅用于参与正常的论坛抽奖活动
4. **独立运行**：此agent与主项目完全独立，可以单独运行

## 自定义话术

编辑 `cmd/lottery-agent/main.go` 中的 `replies` 数组：

```go
var replies = []string{
    "参与一下",
    "谢谢大佬",
    "你的自定义话术",
    // 添加更多...
}
```

## 自定义关键词

编辑 `cmd/lottery-agent/main.go` 中的 `lotteryKeywords` 数组：

```go
var lotteryKeywords = []string{
    "抽奖",
    "送书",
    "你的自定义关键词",
    // 添加更多...
}
```

## Troubleshooting

### 问题：程序启动失败
- 检查是否设置了环境变量
- 检查网络连接

### 问题：一直没有回复
- 检查最近是否有抽奖帖
- 查看日志确认是否检测到
- 确认状态文件中没有误记录

### 问题：重复回复
- 删除 `~/.lottery_agent_state.json` 并重启
- 检查程序是否运行了多个实例

## License

MIT License
